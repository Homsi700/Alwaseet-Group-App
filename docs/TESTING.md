# دليل اختبار نظام الوسيط للإدارة

هذا الدليل يشرح كيفية اختبار الوظائف المختلفة في نظام الوسيط للإدارة.

## إعداد بيئة الاختبار

1. تأكد من تثبيت جميع التبعيات:
   ```bash
   npm install
   ```

2. تأكد من إنشاء قاعدة البيانات وتنفيذ البيانات الاختبارية:
   ```bash
   # إنشاء قاعدة البيانات
   sqlcmd -S localhost -U sa -P YourStrong@Passw0rd -Q "CREATE DATABASE AlwaseetDB"
   
   # تنفيذ البيانات الاختبارية
   sqlcmd -S localhost -U sa -P YourStrong@Passw0rd -d AlwaseetDB -i test-data.sql
   ```

3. تشغيل التطبيق في وضع التطوير:
   ```bash
   npm run dev
   ```

## اختبار المصادقة

### تسجيل الدخول

1. افتح المتصفح على `http://localhost:3000/login`
2. أدخل بيانات تسجيل الدخول:
   - اسم المستخدم: `admin`
   - كلمة المرور: `admin123`
3. انقر على زر "تسجيل الدخول"
4. يجب أن يتم توجيهك إلى لوحة التحكم

### تسجيل الخروج

1. انقر على اسم المستخدم في الزاوية العلوية اليمنى
2. انقر على "تسجيل الخروج"
3. يجب أن يتم توجيهك إلى صفحة تسجيل الدخول

## اختبار إدارة المبيعات

### إنشاء فاتورة جديدة

1. انتقل إلى `http://localhost:3000/sales/invoices`
2. انقر على زر "فاتورة جديدة"
3. املأ بيانات الفاتورة:
   - اختر العميل: "شركة الأمل"
   - اختر طريقة الدفع: "نقدي"
   - أدخل تاريخ الفاتورة
   - أدخل نسبة الخصم: 5%
   - أدخل نسبة الضريبة: 15%
   - أدخل المبلغ المدفوع: 1000
4. أضف منتجات إلى الفاتورة:
   - انقر على زر "إضافة منتج"
   - اختر المنتج: "لابتوب HP"
   - أدخل الكمية: 2
   - تأكد من سعر الوحدة: 3500
   - أدخل نسبة الخصم: 0%
   - أدخل نسبة الضريبة: 15%
5. انقر على زر "حفظ الفاتورة"
6. يجب أن يتم إنشاء الفاتورة وتوجيهك إلى صفحة تفاصيل الفاتورة

### عرض تفاصيل الفاتورة

1. انتقل إلى `http://localhost:3000/sales/invoices`
2. انقر على رقم الفاتورة التي تم إنشاؤها
3. يجب أن يتم عرض تفاصيل الفاتورة

### طباعة الفاتورة

1. انتقل إلى صفحة تفاصيل الفاتورة
2. انقر على زر "طباعة"
3. يجب أن يتم عرض الفاتورة بتنسيق مناسب للطباعة

### حذف الفاتورة

1. انتقل إلى صفحة تفاصيل الفاتورة
2. انقر على زر "حذف"
3. أكد الحذف في النافذة المنبثقة
4. يجب أن يتم حذف الفاتورة وتوجيهك إلى صفحة قائمة الفواتير

## اختبار إدارة العملاء

### إنشاء عميل جديد

1. انتقل إلى `http://localhost:3000/sales/customers`
2. انقر على زر "عميل جديد"
3. املأ بيانات العميل:
   - اسم العميل: "شركة الاختبار"
   - الشخص المسؤول: "محمد الاختبار"
   - رقم الهاتف: "0555555553"
   - البريد الإلكتروني: "test@example.com"
   - العنوان: "الرياض، شارع الاختبار"
   - الرقم الضريبي: "123456789"
4. انقر على زر "حفظ"
5. يجب أن يتم إنشاء العميل وتوجيهك إلى صفحة تفاصيل العميل

### عرض تفاصيل العميل

1. انتقل إلى `http://localhost:3000/sales/customers`
2. انقر على اسم العميل الذي تم إنشاؤه
3. يجب أن يتم عرض تفاصيل العميل

### تحديث بيانات العميل

1. انتقل إلى صفحة تفاصيل العميل
2. انقر على زر "تحرير"
3. قم بتغيير بعض البيانات
4. انقر على زر "حفظ"
5. يجب أن يتم تحديث بيانات العميل

### حذف العميل

1. انتقل إلى صفحة تفاصيل العميل
2. انقر على زر "حذف"
3. أكد الحذف في النافذة المنبثقة
4. يجب أن يتم حذف العميل وتوجيهك إلى صفحة قائمة العملاء

## اختبار إدارة المنتجات

### إنشاء منتج جديد

1. انتقل إلى `http://localhost:3000/sales/products`
2. انقر على زر "منتج جديد"
3. املأ بيانات المنتج:
   - اسم المنتج: "منتج الاختبار"
   - الباركود: "TEST001"
   - الوصف: "منتج للاختبار"
   - الفئة: "إلكترونيات"
   - سعر الشراء: 100
   - سعر البيع: 150
   - الكمية: 10
   - وحدة القياس: "قطعة"
   - الحد الأدنى للكمية: 2
4. انقر على زر "حفظ"
5. يجب أن يتم إنشاء المنتج وتوجيهك إلى صفحة تفاصيل المنتج

### عرض تفاصيل المنتج

1. انتقل إلى `http://localhost:3000/sales/products`
2. انقر على اسم المنتج الذي تم إنشاؤه
3. يجب أن يتم عرض تفاصيل المنتج

### تحديث بيانات المنتج

1. انتقل إلى صفحة تفاصيل المنتج
2. انقر على زر "تحرير"
3. قم بتغيير بعض البيانات
4. انقر على زر "حفظ"
5. يجب أن يتم تحديث بيانات المنتج

### تحديث كمية المنتج

1. انتقل إلى صفحة تفاصيل المنتج
2. انقر على زر "تحديث الكمية"
3. اختر العملية: "إضافة"
4. أدخل الكمية: 5
5. أدخل السبب: "إضافة مخزون"
6. انقر على زر "حفظ"
7. يجب أن يتم تحديث كمية المنتج

### حذف المنتج

1. انتقل إلى صفحة تفاصيل المنتج
2. انقر على زر "حذف"
3. أكد الحذف في النافذة المنبثقة
4. يجب أن يتم حذف المنتج وتوجيهك إلى صفحة قائمة المنتجات

## اختبار واجهة برمجة التطبيقات (API)

يمكن اختبار واجهة برمجة التطبيقات باستخدام أدوات مثل Postman أو curl.

### اختبار المصادقة

#### تسجيل الدخول

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### الحصول على معلومات المستخدم الحالي

```bash
curl http://localhost:3000/api/auth/me \
  -H "Cookie: userId=1; username=admin; role=admin"
```

### اختبار إدارة العملاء

#### الحصول على قائمة العملاء

```bash
curl http://localhost:3000/api/customers \
  -H "Cookie: userId=1; username=admin; role=admin"
```

#### إنشاء عميل جديد

```bash
curl -X POST http://localhost:3000/api/customers \
  -H "Content-Type: application/json" \
  -H "Cookie: userId=1; username=admin; role=admin" \
  -d '{"name":"عميل جديد","phoneNumber":"0555555554","email":"new@example.com"}'
```

### اختبار إدارة المنتجات

#### الحصول على قائمة المنتجات

```bash
curl http://localhost:3000/api/products \
  -H "Cookie: userId=1; username=admin; role=admin"
```

#### إنشاء منتج جديد

```bash
curl -X POST http://localhost:3000/api/products \
  -H "Content-Type: application/json" \
  -H "Cookie: userId=1; username=admin; role=admin" \
  -d '{"name":"منتج جديد","barcode":"NEW001","purchasePrice":200,"salePrice":300,"quantity":20}'
```

### اختبار إدارة الفواتير

#### الحصول على قائمة الفواتير

```bash
curl http://localhost:3000/sales/invoices \
  -H "Cookie: userId=1; username=admin; role=admin"
```

#### إنشاء فاتورة جديدة

```bash
curl -X POST http://localhost:3000/sales/invoices/create \
  -H "Content-Type: application/json" \
  -H "Cookie: userId=1; username=admin; role=admin" \
  -d '{
    "invoice": {
      "customerId": 2,
      "invoiceDate": "2023-05-20",
      "paymentMethod": "نقدي",
      "discountPercent": 5,
      "taxPercent": 15,
      "amountPaid": 1000,
      "status": "Unpaid"
    },
    "items": [
      {
        "productId": 1,
        "quantity": 2,
        "unitPrice": 3500,
        "discountPercent": 0,
        "taxPercent": 15
      }
    ]
  }'
```

## اختبار البيانات المشتركة

### الحصول على قائمة طرق الدفع

```bash
curl http://localhost:3000/api/common?type=paymentMethods \
  -H "Cookie: userId=1; username=admin; role=admin"
```

### الحصول على قائمة حالات الفواتير

```bash
curl http://localhost:3000/api/common?type=invoiceStatuses \
  -H "Cookie: userId=1; username=admin; role=admin"
```

## اختبار تحديث كمية المنتج

```bash
curl -X POST http://localhost:3000/api/rpc/inventory/updateProductQuantity \
  -H "Content-Type: application/json" \
  -H "Cookie: userId=1; username=admin; role=admin" \
  -d '{
    "productId": 1,
    "quantity": 5,
    "operation": "add",
    "reason": "إضافة مخزون"
  }'
```

## ملاحظات هامة

- تأكد من تسجيل الدخول قبل اختبار أي وظيفة تتطلب مصادقة.
- تأكد من وجود البيانات الاختبارية في قاعدة البيانات قبل بدء الاختبار.
- إذا واجهت أي مشاكل، تحقق من سجلات الخادم للحصول على مزيد من المعلومات.